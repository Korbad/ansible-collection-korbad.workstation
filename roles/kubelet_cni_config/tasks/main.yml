- name: Configure kubelet with CNI directories
  ansible.builtin.lineinfile:
    path: /etc/systemd/system/kubelet.service.d/10-kubeadm.conf
    regexp: '^Environment="KUBELET_CONFIG_ARGS=--config=(.*)"$'
    line: 'Environment="KUBELET_CONFIG_ARGS=--config=\1 --cni-conf-dir=/etc/cni/net.d --cni-bin-dir=/opt/cni/bin"'
  become: true
  notify: restart kubelet service