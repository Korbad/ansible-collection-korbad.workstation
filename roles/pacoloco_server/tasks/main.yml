---
- name: Create cache directories for pacoloco
  file:
    path: "/var/cache/pacoloco/pkgs/{{ item }}"
    state: directory
    owner: pacoloco
    group: pacoloco
    mode: '0755'
  become: true
  loop:
    - archlinux
    - archlinux-reflector

- name: Deploy pacoloco config
  template:
    src: pacoloco_config.j2
    dest: "{{ pacoloco_config_path }}"
    owner: root
    group: root
    mode: '0644'
  become: true
  notify: restart pacoloco service

- name: Grant read permission to pacoloco user for reflector
  acl:
    path: "/etc/pacman.d/mirrorlist"
    entity: "pacoloco"
    etype: "user"
    permissions: "r"
    state: "present"
  become: true

- name: Manage pacoloco service
  systemd:
    name: pacoloco
    enabled: yes
    state: started
    daemon_reload: yes
  become: true

