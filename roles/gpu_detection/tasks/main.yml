- name: Ensure pciutils is installed for lspci
  pacman:
    name: pciutils
    state: present
  become: true

- name: Get PCI devices
  command: lspci
  changed_when: false
  register: pci_devices

- name: Determine GPU vendor
  set_fact:
    is_amd_gpu: "{{ 'VGA compatible controller: AMD' in pci_devices.stdout }}"
    is_nvidia_gpu: "{{ 'VGA compatible controller: NVIDIA' in pci_devices.stdout }}"
    is_intel_gpu: "{{ 'VGA compatible controller: Intel Corporation HD Graphics' in pci_devices.stdout }}"