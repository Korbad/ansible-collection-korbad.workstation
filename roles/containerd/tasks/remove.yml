- name: Check if containerd service file exists
  ansible.builtin.stat:
    path: /etc/systemd/system/containerd.service
  register: containerd_service_file

- name: Ensure the containerd service is disabled and stopped
  ansible.builtin.systemd:
    name: containerd
    state: stopped
    enabled: false
  become: true
  when: containerd_service_file.stat.exists

- name: Ensure containerd is not installed
  ansible.builtin.package:
    name: containerd
    state: absent
  become: true
