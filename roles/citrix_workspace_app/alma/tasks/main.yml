---
- name: Parse accept hash from Linux download overview
  shell:
    cmd: "wget -q -O- {{ citrix_overview_url }} | grep '{{ citrix_hash_start_marker }}' | sed -e 's/^.*{{ citrix_hash_start_marker }}//' -e 's/{{ citrix_hash_stop_marker }}.*$//' | uniq"
    warn: false
  register: citrix_accepthash

- name: Install Citrix client (Workspace App)
  apt:
    deb: '{{ citrix_download_url }}'

- name: Ensure CA certificates (system)
  package:
    name: ca-certificates
    state: latest

- name: Remove CA certs shipped by Citrix
  file:
    path: /opt/Citrix/ICAClient/keystore/cacerts
    state: absent

- name: Use system CA certs with Citrix client
  file:
    src: /etc/ssl/certs
    path: /opt/Citrix/ICAClient/keystore/cacerts
    state: link