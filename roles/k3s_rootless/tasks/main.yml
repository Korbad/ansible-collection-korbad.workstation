---
- name: Ensure .kube user directory exists
  file:
    state: directory
    dest: "{{ user_kubeconfig_path | dirname }}"

- name: Copy k3s.yaml from Rancher to userspace ~/.kube/config
  copy:
    src: "{{ kubeconfig_path }}"
    dest: "{{ user_kubeconfig_path }}"
    remote_src: true
    mode: 0600
    owner: "{{ ansible_env.USER }}"
    group: "{{ ansible_env.USER }}"
  become: true

- name: Override kubeconfig_path with user path
  set_fact:
    kubeconfig_path: "{{ user_kubeconfig_path }}"
