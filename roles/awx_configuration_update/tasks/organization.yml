- name: Build fact which contains AWX configuration with defaults applied
  set_fact:
    awx_configuration_with_defaults: "{{ awx_configuration_with_defaults | default({},True) |  combine(awx_organization_path, recursive=True)  }}"
  vars:
    awx_organization_with_defaults: "{{ awx_configuration.organization_defaults | combine(awx_organization.value, recursive=True) }}"
    awx_organization_path:
      organizations: "{{ {awx_organization.key: awx_organization_with_defaults} }}"

- debug:
    var: awx_configuration_with_defaults

- name: Process each project within this org
  include_tasks: project.yml
  loop: "{{ awx_organization.value.projects | dict2items }}"
  loop_control:
    loop_var: awx_project
    label: "{{ awx_project.key }}"
  vars:
    awx_organization_with_defaults: "{{ awx_configuration.organization_defaults | combine(awx_organization.value, recursive=True) }}"