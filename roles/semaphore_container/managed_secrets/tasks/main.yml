---
- name: Ensure secret exists
  include_role:
    name: korbad.project_management.managed_secret
  vars:
    managed_secret_name: "{{ item }}"
  loop:
  - semaphore_password
  - db_password
  - dbroot_password

- name: Execute main role
  include_role:
    name: semaphore_container
  vars:
    semaphore_password: "{{ lookup('file', managed_secrets_path+'/semaphore_password') }}"
    db_password: "{{ lookup('file', managed_secrets_path+'/db_password') }}"
    dbroot_password: "{{ lookup('file', managed_secrets_path+'/dbroot_password') }}"
