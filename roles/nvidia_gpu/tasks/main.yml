- name: Remove nouveau driver
  pacman:
    name:
    - xf86-video-nouveau
    state: absent

- name: Install common packages for NVIDIA gpu
  pacman:
    name: 
      - nvidia 
      - nvidia-settings 
      - nvidia-utils
  become: true
  changed_when: true
  notify:
    - modprobe nvidia
    - generate nvidia xorg config

- name: Create blacklist file in /etc/modprobe.d/
  copy:
    dest: /etc/modprobe.d/nouveau_blacklist.conf
    content: blacklist nouveau
    owner: root
    group: root
    mode: 0644
  become: true
  notify:
    - rebuild initramfs

## OpenCL packages for NVIDIA GPU
#- name: Install OpenCL packages for NVIDIA gpu
#  pacman:
#    name:
#      - opencl-nvidia
#    state: present
#  become: true
#
