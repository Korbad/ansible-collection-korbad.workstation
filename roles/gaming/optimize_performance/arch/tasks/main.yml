- name: Ensure thermald service exist
  package:
    name: thermald

- name: Start and Enable thermald service
  systemd:
    name: thermald
    state: started
    enabled: true
  become: true

- name: Install auto-cpufreq from AUR
  kewlfft.aur.aur:
    name: auto-cpufreq
    update_cache: true
    state: latest

- name: Start and Enable auto-cpufreq service
  systemd:
    name: auto-cpufreq
    state: started
    enabled: true
  become: true

- name: Get compositor
  shell: inxi -Gxx | grep compositor | cut -d ':' -f5 | cut -d ' ' -f2
  register: compositor

- name: Kill compositor
  shell: "pkill {{compositor.stdout}}"

- name: Get GPU device
  shell: glxinfo | grep "Device"
  register: gpu_device

- name: Install packages for AMD gpu
  package:
    name: 
      - mesa 
      - lib32-mesa 
      - mesa-vdpau 
      - lib32-mesa-vdpau 
      - lib32-vulkan-radeon 
      - vulkan-radeon 
      - glu 
      - lib32-glu 
      - vulkan-icd-loader 
      - lib32-vulkan-icd-loader
  when: '"AMD" in gpu_device.stdout'

- name: Install packages for NVIDIA gpu
  package:
    name: 
      - nvidia 
      - nvidia-settings 
      - nvidia-utils 
      - lib32-nvidia-utils 
      - lib32-opencl-nvidia 
      - opencl-nvidia 
      - libvdpau 
      - libxnvctrl 
      - vulkan-icd-loader 
      - lib32-vulkan-icd-loader
  when: '"NVIDIA" in gpu_device.stdout'